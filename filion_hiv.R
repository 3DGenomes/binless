library(csnorm)
library(data.table)
library(ggplot2)
library(doParallel)
library(foreach)
library(scales)


setwd("/home/yannick/simulations/cs_norm")

a=examine_dataset("/scratch/fillon/E6N_hg19e6_chr2_199M-201M.tsv",skip=0,nrows=1e6,skip.fbm=F, read.len=75)
'a$data[category!="none"]
   re.closest2 re.closest2.idx re.closest1 re.closest1.idx                                      id    begin1 strand1 length1    re.up1
1:   199002357              10   199002357              10  D00733:206:CB0CFANXX:1:1215:18796:3007 199002287       0      75 199002086
2:   199003072              11   199002357              10 D00733:206:CB0CFANXX:2:2311:17438:73274 199002287       0      75 199002086
3:   199003126              12   199003072              11 D00733:209:CB0CBANXX:1:2111:15749:87306 199003073       1      54 199003072
4:   199003126              12   199003072              11 D00733:209:CB0CBANXX:2:2205:15446:26245 199003073       0      61 199003072
re.dn1    begin2 strand2 length2    re.up2    re.dn2   rbegin1     rend1   rbegin2     rend2 category
1: 199002357 199002567       0      75 199002357 199003072 199002287 199002213 199002567 199002493     test
2: 199002357 199002731       0      75 199002357 199003072 199002287 199002213 199002731 199002657     test
3: 199003126 199003188       1      75 199003126 199003655 199003073 199003126 199003188 199003262    test2
4: 199003126 199003193       0      75 199003126 199003655 199003073 199003013 199003193 199003119    test2
'
plot_raw(a$data,b1=a$data[,min(rbegin1)+2000],e1=a$data[,min(rbegin1)+4000])

"
D00733:206:CB0CFANXX:1:1215:18796:3007    97    chr2    199002287    60    75M    =    199002567    355    TGTAAGACTGGAGGAGGATTCTTGCCTCTCCTCCAGGCAAGCATAAAAAAATCCTTGTACTGTGTTTCACTGATC    CCCCBGGGGGFBGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGFGGGGGGGG    NM:i:0    MD:Z:75    AS:i:75    XS:i:18
D00733:206:CB0CFANXX:1:1215:18796:3007    145    chr2    199002567    60    75M    =    199002287    -355    GTTCCGTAGGGGCAGGGATGATGTCTGTGCTCACTTTTGTAACCCCCAGAGTCCAGCCTGGTGATTCTCAATGGG    GGGGGGGGGGGGGGGGGGGGGGGGFGGFGGGGGGGGGGGGGGGGGGGGGGGGGFGGGGGGGGDFGGGGEGBBCCC    NM:i:0    MD:Z:75    AS:i:75    XS:i:18

D00733:206:CB0CFANXX:2:2311:17438:73274    97    chr2    199002287    60    75M    =    199002731    519    TGTAAGACTGGAGGAGGATTCTTGCCTCTCCTCCAGGCAAGCATAAAAAAATCCTTGTACTGTGTTTCACTGATC    B@BABGD1CGGGGGGGGGGGGGGGGGGGGGGG>@BG>>EEDGGGG11DG/EFCGGGCG@FBFGGD1FGG>GGE@G    NM:i:0    MD:Z:75    AS:i:75    XS:i:18
D00733:206:CB0CFANXX:2:2311:17438:73274    145    chr2    199002731    60    75M    =    199002287    -519    TTTGATGTCATGCTCTGGGCAGGGCAGTACAACATGATGAAAAATGTCCTGTGTCCTGCAAGATTTCTGTTAAGT    F1GGD1>F1GGDGFF:GG@DCE1FED@GFCGFGGDDC1FCGFECED:GBGG@DB>FF>GGGGFC1BG@B1BABA?    NM:i:0    MD:Z:75    AS:i:75    XS:i:19

D00733:209:CB0CBANXX:1:2111:15749:87306    81    chr2    199003188    60    75M    =    199003073    -190    ATTTGGGTGGGGACACAGAGCCAAACCATATCACCCTCTAAAATACAAATCAGAATACTTTAGTATATGATATTA    GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGBGGGGGGFGGGGGGGGGGGGGGGGGGGGGGGGGGGGGCCCCB    NM:i:0    MD:Z:75    AS:i:75    XS:i:39
D00733:209:CB0CBANXX:1:2111:15749:87306    161    chr2    199003073    60    21S54M    =    199003188    190    GGAGGCTGAGATAGAAGGATCGATCTCCTGAGAACTTACTATCACAAGAACAACAAGGAGGAAATCTGCCCCTTT    BBBCCGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGEGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG    NM:i:0    MD:Z:54    AS:i:54    XS:i:33

D00733:209:CB0CBANXX:2:2205:15446:26245    97    chr2    199003073    60    14S61M    =    199003193    195    ATTTTAGTAAGATCGATCTCCTGAGAACTTACTATCACAAGAACAACAAGGAGGAAATCTGCCCCTTTGATCCAT    CCCCCGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG    NM:i:0    MD:Z:61    AS:i:61    XS:i:33
D00733:209:CB0CBANXX:2:2205:15446:26245    145    chr2    199003193    60    75M    =    199003073    -195    GGTGGGGACACAGAGCCAAACCATATCACCCTCTAAAATACAAATCAGAATACTTTAGTATATGATATTAATTAA    GGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGFGGGGGGGGGGGFGGGGGGGGGGGGGGGGCCBCC    NM:i:0    MD:Z:75    AS:i:75    XS:i:20"

flag:
  97  = 1 + 32 + 64  = "paired-end + next is rev + read1"
  145 = 1 + 16 + 128 = "paired-end + this is rev + read2"
  81  = 1 + 16 + 64  = "paired-end + this is rev + read1"
  161 = 1 + 32 + 128 = "paired-end + next is rev + read2"


